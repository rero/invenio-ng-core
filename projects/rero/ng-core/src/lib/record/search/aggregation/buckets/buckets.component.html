<!--
  RERO angular core
  Copyright (C) 2020-2024 RERO

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published by
  the Free Software Foundation, version 3 of the License.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
@if (buckets()) {
  <ul class="list-none m-0 bucket-group">
  @for (bucket of buckets()|slice:0:bucketSize; track bucket; let index = $index) {
    <li class="bucket-item">
      <div class="flex align-items-stretch mb-1 bucket-data">
        @if (bucket.doc_count) {
          <div class="flex flex-grow-1 align-items-center">
            <p-triStateCheckbox
              inputId="{{ bucket.aggregationKey }}-{{ index }}"
              variant="outlined"
              class="mr-1"
              [ngModel]="bucket.indeterminate ? false : isSelected(bucket.key)"
              (onChange)="updateFilter(bucket)"
            />
            <label class="bucket-label mb-0" for="{{ bucket.aggregationKey }}-{{ index }}">
              @if (bucket.name) {
                {{ bucket.name }}
              } @else {
                {{ bucket.key | bucketName: aggregationKey() | async }}
              }
            </label>
          </div>
          <div class="bucket-count flex flex-none align-items-center ml-2">
            {{ bucket.doc_count }}
          </div>
        }
      </div>
      <div class="ml-4">
        @if (displayChildren(bucket)) {
          @for (aggregation of bucketChildren[bucket.key]; track aggregation) {
            <ng-core-record-search-aggregation-buckets
              [buckets]="aggregation.buckets"
              [size]="aggregation.bucketSize"
              [aggregationKey]="aggregation.key"
            ></ng-core-record-search-aggregation-buckets>
          }
        }
      </div>
    </li>
  }
  </ul>
}
@if (displayMoreAndLessLink) {
  <p-button class="ml-1" [link]="true" [label]="(moreMode ? 'more…' : 'less…') | translate" (onClick)="moreMode = !moreMode"></p-button>
}
